version: '3.8'

services:
  webshare-downloader:
    build: .
    container_name: webshare-downloader
    restart: unless-stopped
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
      - /mnt:/mnt
    environment:
      # Webshare credentials
      - WEBSHARE_USER=${WEBSHARE_USER:-mates91}
      - WEBSHARE_PASS=${WEBSHARE_PASS:-afdm54F3}

      # pyLoad settings
      - PYLOAD_URL=${PYLOAD_URL:-https://pyload.homelab.carpiftw.cz}
      - PYLOAD_USER=${PYLOAD_USER:-pyload}
      - PYLOAD_PASS=${PYLOAD_PASS:-v4G#2uPXj5dvL9%aWHLs}
      - PYLOAD_DOWNLOAD_DIR=${PYLOAD_DOWNLOAD_DIR:-/mnt/sdb1/pyload_downlaoded}

      # File mover settings
      - MONITOR_INTERVAL_SECONDS=${MONITOR_INTERVAL_SECONDS:-60}

      # Plex settings (for future use)
      - PLEX_URL=${PLEX_URL:-}
      - PLEX_TOKEN=${PLEX_TOKEN:-}

      # Sonarr settings
      - SONARR_URL=${SONARR_URL:-https://sonarr.homelab.carpiftw.cz}
      - SONARR_API_KEY=${SONARR_API_KEY:-66bff25cbaa142b7b925a92078a065a9}

      # Radarr settings
      - RADARR_URL=${RADARR_URL:-https://radarr.homelab.carpiftw.cz}
      - RADARR_API_KEY=${RADARR_API_KEY}

      # Search preferences
      - PREFER_CZECH=${PREFER_CZECH:-true}
      - MIN_QUALITY=${MIN_QUALITY:-720p}
      - MAX_SIZE_GB=${MAX_SIZE_GB:-50}
      - SEARCH_LIMIT=${SEARCH_LIMIT:-50}

      # Cache settings
      - CACHE_TTL_DAYS=${CACHE_TTL_DAYS:-7}
      - HISTORY_TTL_DAYS=${HISTORY_TTL_DAYS:-30}

      # Flask settings
      - SECRET_KEY=${SECRET_KEY:-change-this-in-production}
      - DEBUG=${DEBUG:-false}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}

    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.webshare.rule=Host(`webshare-downloader.homelab.carpiftw.cz`)"
      - "traefik.http.routers.webshare.entrypoints=websecure"
      - "traefik.http.routers.webshare.tls=true"
      - "traefik.http.routers.webshare.tls.certresolver=cloudflare"
      - "traefik.http.services.webshare.loadbalancer.server.port=5050"

    networks:
      - proxy

networks:
  proxy:
    external: true
